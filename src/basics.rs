// ============================================================================
// RuståŸºæœ¬æ§‹æ–‡ã‚µãƒ³ãƒ—ãƒ« - å¤‰æ•°ã€ãƒ‡ãƒ¼ã‚¿å‹ã€é–¢æ•°
// å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://doc.rust-lang.org/book/ch03-00-common-programming-concepts.html
// ============================================================================

/// å¤‰æ•°ã¨å¯å¤‰æ€§ã®ãƒ‡ãƒ¢
/// Rustã§ã¯å¤‰æ•°ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸å¤‰ï¼ˆimmutableï¼‰
/// mutã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã†ã“ã¨ã§å¯å¤‰ï¼ˆmutableï¼‰ã«ã§ãã‚‹
pub fn variables_demo() {
    println!("\n=== å¤‰æ•°ã¨å¯å¤‰æ€§ ===");

    // ä¸å¤‰å¤‰æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
    let x = 5;
    println!("ä¸å¤‰å¤‰æ•° x = {}", x);
    // x = 6; // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼ä¸å¤‰å¤‰æ•°ã¯å†ä»£å…¥ã§ããªã„

    // å¯å¤‰å¤‰æ•°
    let mut y = 5;
    println!("å¯å¤‰å¤‰æ•° y = {}", y);
    y = 6;
    println!("y ã‚’å¤‰æ›´å¾Œ: y = {}", y);

    // ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚° - åŒã˜åå‰ã®å¤‰æ•°ã‚’å†å®šç¾©ã§ãã‚‹
    let z = 5;
    let z = z + 1; // æ–°ã—ã„å¤‰æ•°zãŒå‰ã®zã‚’ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°
    let z = z * 2;
    println!("ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°å¾Œã® z = {}", z); // 12

    // ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°ã§ã¯å‹ã‚‚å¤‰æ›´å¯èƒ½
    let spaces = "   "; // &strå‹
    let spaces = spaces.len(); // usizeå‹ã«å¤‰æ›´
    println!("spacesã®é•·ã•: {}", spaces);
}

/// å®šæ•°ã®ãƒ‡ãƒ¢
/// å®šæ•°ã¯å¸¸ã«ä¸å¤‰ã§ã€å‹æ³¨é‡ˆãŒå¿…é ˆ
pub fn constants_demo() {
    println!("\n=== å®šæ•° ===");

    // å®šæ•°ã¯å¤§æ–‡å­—ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã§å‘½å
    const MAX_POINTS: u32 = 100_000;
    const PI: f64 = 3.14159;

    println!("MAX_POINTS = {}", MAX_POINTS);
    println!("PI = {}", PI);
}

/// ãƒ‡ãƒ¼ã‚¿å‹ã®ãƒ‡ãƒ¢
/// Rustã¯é™çš„å‹ä»˜ã‘è¨€èªã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã™ã¹ã¦ã®å¤‰æ•°ã®å‹ãŒæ±ºã¾ã‚‹
pub fn data_types_demo() {
    println!("\n=== ãƒ‡ãƒ¼ã‚¿å‹ ===");

    // --- ã‚¹ã‚«ãƒ©ãƒ¼å‹ ---
    println!("\n-- ã‚¹ã‚«ãƒ©ãƒ¼å‹ --");

    // æ•´æ•°å‹
    let _i8: i8 = -128; // 8ãƒ“ãƒƒãƒˆç¬¦å·ä»˜ã
    let _u8: u8 = 255; // 8ãƒ“ãƒƒãƒˆç¬¦å·ãªã—
    let _i32: i32 = -2_147_483_648; // 32ãƒ“ãƒƒãƒˆç¬¦å·ä»˜ãï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
    let _u64: u64 = 18_446_744_073_709_551_615; // 64ãƒ“ãƒƒãƒˆç¬¦å·ãªã—
    let _isize: isize = 100; // ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä¾å­˜ï¼ˆ32 or 64ãƒ“ãƒƒãƒˆï¼‰

    println!("æ•´æ•°ãƒªãƒ†ãƒ©ãƒ«:");
    println!("  10é€²æ•°: {}", 98_222);
    println!("  16é€²æ•°: {}", 0xff);
    println!("  8é€²æ•°: {}", 0o77);
    println!("  2é€²æ•°: {}", 0b1111_0000);
    println!("  ãƒã‚¤ãƒˆ(u8ã®ã¿): {}", b'A');

    // æµ®å‹•å°æ•°ç‚¹å‹
    let float64: f64 = 3.14159; // 64ãƒ“ãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
    let float32: f32 = 2.5; // 32ãƒ“ãƒƒãƒˆ
    println!("f64: {}, f32: {}", float64, float32);

    // æ•°å€¤æ¼”ç®—
    println!("\næ•°å€¤æ¼”ç®—:");
    println!("  åŠ ç®—: 5 + 10 = {}", 5 + 10);
    println!("  æ¸›ç®—: 95.5 - 4.3 = {}", 95.5 - 4.3);
    println!("  ä¹—ç®—: 4 * 30 = {}", 4 * 30);
    println!("  é™¤ç®—: 56.7 / 32.2 = {}", 56.7 / 32.2);
    println!("  æ•´æ•°é™¤ç®—: 5 / 3 = {}", 5 / 3); // çµæœã¯1
    println!("  å‰°ä½™: 43 % 5 = {}", 43 % 5);

    // ãƒ–ãƒ¼ãƒªã‚¢ãƒ³å‹
    let t: bool = true;
    let f: bool = false;
    println!("\nãƒ–ãƒ¼ãƒªã‚¢ãƒ³: true={}, false={}", t, f);

    // æ–‡å­—å‹
    let c: char = 'z';
    let emoji: char = 'ğŸ¦€'; // Unicodeã‚¹ã‚«ãƒ©ãƒ¼å€¤ã‚’æ ¼ç´
    let kanji: char = 'æ¼¢';
    println!("æ–‡å­—å‹: c='{}', emoji='{}', kanji='{}'", c, emoji, kanji);

    // --- è¤‡åˆå‹ ---
    println!("\n-- è¤‡åˆå‹ --");

    // ã‚¿ãƒ—ãƒ«å‹ - ç•°ãªã‚‹å‹ã®å€¤ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    let tup: (i32, f64, u8) = (500, 6.4, 1);
    let (x, y, z) = tup; // åˆ†è§£ï¼ˆãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒªãƒ³ã‚°ï¼‰
    println!("ã‚¿ãƒ—ãƒ«åˆ†è§£: x={}, y={}, z={}", x, y, z);
    println!(
        "ã‚¿ãƒ—ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¢ã‚¯ã‚»ã‚¹: tup.0={}, tup.1={}, tup.2={}",
        tup.0, tup.1, tup.2
    );

    // ãƒ¦ãƒ‹ãƒƒãƒˆå‹ - ç©ºã®ã‚¿ãƒ—ãƒ«ã€å€¤ã‚’è¿”ã•ãªã„å¼ã®æˆ»ã‚Šå€¤
    let _unit: () = ();

    // é…åˆ—å‹ - åŒã˜å‹ã®å›ºå®šé•·ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
    let arr: [i32; 5] = [1, 2, 3, 4, 5];
    println!("é…åˆ—: {:?}", arr);
    println!("é…åˆ—ã®æœ€åˆã®è¦ç´ : arr[0] = {}", arr[0]);

    // åŒã˜å€¤ã§åˆæœŸåŒ–
    let zeros = [0; 5]; // [0, 0, 0, 0, 0]
    println!("ã‚¼ãƒ­ã§åˆæœŸåŒ–ã—ãŸé…åˆ—: {:?}", zeros);
}

/// é–¢æ•°ã®ãƒ‡ãƒ¢
/// Rustã®é–¢æ•°ã¯fnã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§å®šç¾©
pub fn functions_demo() {
    println!("\n=== é–¢æ•° ===");

    // å¼•æ•°ãªã—ã®é–¢æ•°å‘¼ã³å‡ºã—
    simple_function();

    // å¼•æ•°ã‚ã‚Šã®é–¢æ•°å‘¼ã³å‡ºã—
    print_value(42);
    print_labeled_measurement(5, 'h');

    // æˆ»ã‚Šå€¤ã®ã‚ã‚‹é–¢æ•°
    let result = add(5, 3);
    println!("add(5, 3) = {}", result);

    // å¼ã¨æ–‡ã®é•ã„
    let y = {
        let x = 3;
        x + 1 // ã‚»ãƒŸã‚³ãƒ­ãƒ³ãªã— = å¼ï¼ˆå€¤ã‚’è¿”ã™ï¼‰
    };
    println!("ãƒ–ãƒ­ãƒƒã‚¯å¼ã®çµæœ: y = {}", y);

    // æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
    let five = return_five();
    println!("return_five() = {}", five);
}

// å˜ç´”ãªé–¢æ•°
fn simple_function() {
    println!("  simple_function ãŒå‘¼ã°ã‚Œã¾ã—ãŸ");
}

// å¼•æ•°ã‚’æŒã¤é–¢æ•°ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹æ³¨é‡ˆã¯å¿…é ˆï¼‰
fn print_value(x: i32) {
    println!("  print_value: x = {}", x);
}

// è¤‡æ•°ã®å¼•æ•°
fn print_labeled_measurement(value: i32, unit_label: char) {
    println!("  measurement: {}{}", value, unit_label);
}

// æˆ»ã‚Šå€¤ã®ã‚ã‚‹é–¢æ•°ï¼ˆ-> ã§æˆ»ã‚Šå€¤ã®å‹ã‚’æŒ‡å®šï¼‰
fn add(a: i32, b: i32) -> i32 {
    a + b // æœ€å¾Œã®å¼ãŒæˆ»ã‚Šå€¤ï¼ˆã‚»ãƒŸã‚³ãƒ­ãƒ³ãªã—ï¼‰
}

// returnã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
fn return_five() -> i32 {
    return 5;
    // ã“ã®ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯å®Ÿè¡Œã•ã‚Œãªã„
}

/// åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã®ãƒ‡ãƒ¢
pub fn control_flow_demo() {
    println!("\n=== åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ ===");

    // --- ifå¼ ---
    println!("\n-- ifå¼ --");
    let number = 6;

    if number % 4 == 0 {
        println!("{} ã¯4ã§å‰²ã‚Šåˆ‡ã‚Œã‚‹", number);
    } else if number % 3 == 0 {
        println!("{} ã¯3ã§å‰²ã‚Šåˆ‡ã‚Œã‚‹", number);
    } else if number % 2 == 0 {
        println!("{} ã¯2ã§å‰²ã‚Šåˆ‡ã‚Œã‚‹", number);
    } else {
        println!("{} ã¯4, 3, 2ã§å‰²ã‚Šåˆ‡ã‚Œãªã„", number);
    }

    // ifã¯å¼ãªã®ã§letã§ä½¿ãˆã‚‹
    let condition = true;
    let value = if condition { 5 } else { 6 };
    println!("æ¡ä»¶å¼ã®çµæœ: value = {}", value);

    // --- ãƒ«ãƒ¼ãƒ— ---
    println!("\n-- ãƒ«ãƒ¼ãƒ— --");

    // loop - ç„¡é™ãƒ«ãƒ¼ãƒ—ï¼ˆbreakã§æŠœã‘ã‚‹ï¼‰
    let mut counter = 0;
    let result = loop {
        counter += 1;
        if counter == 10 {
            break counter * 2; // breakã§å€¤ã‚’è¿”ã›ã‚‹
        }
    };
    println!("loopã®çµæœ: {}", result);

    // ãƒ«ãƒ¼ãƒ—ãƒ©ãƒ™ãƒ« - ãƒã‚¹ãƒˆã—ãŸãƒ«ãƒ¼ãƒ—ã§å¤–å´ã®ãƒ«ãƒ¼ãƒ—ã‚’åˆ¶å¾¡
    let mut count = 0;
    'counting_up: loop {
        let mut remaining = 10;
        loop {
            if remaining == 9 {
                break; // å†…å´ã®ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹
            }
            if count == 2 {
                break 'counting_up; // å¤–å´ã®ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹
            }
            remaining -= 1;
        }
        count += 1;
    }
    println!("ãƒ«ãƒ¼ãƒ—ãƒ©ãƒ™ãƒ«ã®ä¾‹: count = {}", count);

    // while - æ¡ä»¶ä»˜ããƒ«ãƒ¼ãƒ—
    let mut number = 3;
    while number != 0 {
        println!("while: {}!", number);
        number -= 1;
    }
    println!("whileçµ‚äº†!");

    // for - ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®åå¾©
    let a = [10, 20, 30, 40, 50];
    for element in a {
        println!("for: å€¤ã¯ {}", element);
    }

    // Rangeã‚’ä½¿ã£ãŸfor
    println!("Rangeã§ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³:");
    for number in (1..4).rev() {
        println!("  {}!", number);
    }
}

/// ã™ã¹ã¦ã®ãƒ‡ãƒ¢ã‚’å®Ÿè¡Œ
pub fn run_all() {
    println!("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    println!("â•‘          RuståŸºæœ¬æ§‹æ–‡ã‚µãƒ³ãƒ—ãƒ«                                   â•‘");
    println!("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

    variables_demo();
    constants_demo();
    data_types_demo();
    functions_demo();
    control_flow_demo();
}
